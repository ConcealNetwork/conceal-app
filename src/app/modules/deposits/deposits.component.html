<app-loader *ngIf="this.depositsLoading || this.walletsLoading"></app-loader>

<div class="container" fxLayout="column" fxLayoutGap="15px" fxLayoutGap.gt-md="25px" *ngIf="!this.depositsLoading && !this.walletsLoading">

	<div fxLayout="column" fxFlex="auto" fxLayoutAlign="start">

		<div [ngClass]="{'emulated-flex-gap' : this.getThemingService().isSmallScreen}" fxLayout="row wrap" fxLayoutGap="0px" fxLayoutGap.gt-sm="25px grid" @transition>

			<!-- New Deposit -->
			<div id="cards" fxFlex="100" fxFlex.md="50" fxFlex.lg="50" fxFlex.xl="30">
				<form [formGroup]="deposit">
					<mat-card class="mat-elevation-z6">

						<mat-card-header fxLayout="column">
							<h2 class="title">New Deposit</h2>
						</mat-card-header>

						<mat-card-content fxLayout="column" fxLayoutGap="15px">

							<fieldset fxLayout="column" fxFlex="noshrink">
								<legend>Deposit Value</legend>

								<div fxLayout="column" fxFlex="noshrink" fxLayoutGap="25px">

									<div fxLayout="row" fxLayout.lt-lg="column" fxLayoutAlign="start stretch" fxLayoutGap="15px">
										<mat-form-field hintLabel="The wallet for the deposit" color="accent" appearance="fill" fxFlex="noshrink">
											<mat-label>Wallet</mat-label>
											<mat-select #wallet name="wallet" formControlName="wallet" (selectionChange)="selectWallet($event.value)">
												<mat-option [value]="item.key" *ngFor="let item of this.wallets | keyvalue" >
													{{ this.getHelperService().formatAddress(item.key) + ' (' + this.getHelperService().formatAmount($any(item).value.balance, 1, 6) + ')' }}
												</mat-option>
											</mat-select>
											<mat-error *ngIf="deposit.controls.wallet.hasError('required')">
												Wallet is <strong>required</strong>
											</mat-error>
											<mat-error *ngIf="deposit.controls.wallet.hasError('minlength') || deposit.controls.wallet.hasError('maxlength')">
												Address must be <strong>98 characters</strong>
											</mat-error>
										</mat-form-field>

										<mat-form-field hintLabel="The amount for the deposit" color="accent" appearance="fill" fxFlex="noshrink">
											<mat-label>Amount</mat-label>
											<input #amount matInput numeric steps="0" min="0.000001" type="number" name="amount" placeholder="100" formControlName="amount">
											<span matSuffix>CCX</span>
											<mat-error *ngIf="deposit.controls.amount.hasError('required')">
												Amount is <strong>required</strong>
											</mat-error>
											<mat-error *ngIf="deposit.controls.amount.hasError('pattern') || !deposit.controls.amount.valid">
												Amount is <strong>not a valid value</strong>
											</mat-error>
										</mat-form-field>
									</div>

									<div fxLayout="row wrap" fxLayoutAlign="space-between stretch" fxFlex="noshrink" fxLayoutGap="15px">
										<button fxFlex="noshrink" color="accent" class="balance" mat-stroked-button aria-hidden="false" aria-label="Add 25% of balance" matTooltip="Add 25% of balance" matTooltipPosition="below" matTooltipClass="custom-tooltip" type="button" (click)="setAmount(25, wallet.value)" [disabled]="!this.selectedWallet">25%</button>
										<button fxFlex="noshrink" color="accent" class="balance" mat-stroked-button aria-hidden="false" aria-label="Add 50% of balance" matTooltip="Add 50% of balance" matTooltipPosition="below" matTooltipClass="custom-tooltip" type="button" (click)="setAmount(50, wallet.value)" [disabled]="!this.selectedWallet">50%</button>
										<button fxFlex="noshrink" fxHide.xs color="accent" class="balance" mat-stroked-button aria-hidden="false" aria-label="Add 75% of balance" matTooltip="Add 75% of balance" matTooltipPosition="below" matTooltipClass="custom-tooltip" type="button" (click)="setAmount(75, wallet.value)" [disabled]="!this.selectedWallet">75%</button>
										<button fxFlex="noshrink" color="accent" class="balance" mat-stroked-button aria-hidden="false" aria-label="Add 100% of balance" matTooltip="Add 100% of balance" matTooltipPosition="below" matTooltipClass="custom-tooltip" type="button" (click)="setAmount(100, wallet.value)" [disabled]="!this.selectedWallet">Max</button>
									</div>

								</div>

							</fieldset>

							<fieldset fxLayout="column" fxFlex="noshrink">
								<legend>Deposit Length</legend>
								<div fxLayout="column" fxFlex fxLayoutGap="15px">
									<mat-form-field hintLabel="The term of the deposit" color="accent" appearance="fill" fxFlex>
										<mat-label>Fixed Term</mat-label>
										<input #term matInput numeric steps="1" min="1" max="12" type="number" name="term" placeholder="1" formControlName="term" (input)="termChanges(term.value)">
										<span matSuffix>Month<span *ngIf="(termLength > 1 || termLength === 0)">s</span></span>
										<mat-error *ngIf="deposit.controls.term.hasError('required')">
											Term is <strong>required</strong>
										</mat-error>
										<mat-error *ngIf="deposit.controls.term.hasError('pattern') || deposit.controls.term.hasError('minlength') || deposit.controls.term.hasError('maxlength')">
											Term must be between <strong>1 and 12</strong>
										</mat-error>
									</mat-form-field>
									<div *ngIf="this.showSlider" fxLayout="column" fxFlex="noshrink">
										<mat-slider [value]="termLength" class="slider" color="accent" thumbLabel tickInterval="1" step="1" min="0" max="12" aria-label="units" (input)="termChanges($event.value)"></mat-slider>
									</div>
								</div>
							</fieldset>

							<fieldset fxLayout="column" fxFlex="noshrink">
								<legend>Interest Calculation</legend>
								<div fxLayout="row" fxLayout.lt-lg="column" fxLayoutAlign="start stretch" fxLayoutGap="15px">
									<mat-form-field fxFlex hintLabel="The interest rate of the deposit" color="accent" appearance="fill">
										<mat-label>Your Rate</mat-label>
										<input #rate matInput numeric type="number" name="rate" placeholder="1" formControlName="rate" readonly>
										<span matSuffix>%</span>
									</mat-form-field>
									<mat-form-field fxFlex hintLabel="The interest amount of the deposit" color="accent" appearance="fill">
										<mat-label>Interest Paid</mat-label>
										<input #interest matInput numeric type="number" name="interest" placeholder="1" formControlName="interest" readonly>
										<span matSuffix>CCX</span>
									</mat-form-field>
								</div>
							</fieldset>

						</mat-card-content>

						<mat-card-actions fxLayout="column">
							<div class="actions" fxLayout="row wrap" fxLayout.lt-md="column" fxLayoutAlign="space-between stretch" fxLayoutGap="15px">
								<button type="submit" color="warn" mat-stroked-button fxFlex="noshrink" (click)="reset()">Reset</button>
								<button type="button" color="accent" mat-stroked-button fxFlex="noshrink" (click)="getDialogService().openMatrixDialog()">Interest Table</button>
								<button type="submit" color="accent" mat-flat-button fxFlex="noshrink" (click)="submit()" [disabled]="!deposit.valid">Create Deposit</button>
							</div>
						</mat-card-actions>

					</mat-card>
				</form>
			</div>

			<!-- Locked Deposits -->
			<div id="cards" fxFlex="100" fxFlex.md="50" fxFlex.lg="50" fxFlex.xl="auto">
				<mat-card class="mat-elevation-z6" fxFlex="100%">
					<mat-card-header fxLayout="column">
						<h2 class="title">Locked Deposits</h2>
					</mat-card-header>
					<mat-card-content>
						<div *ngIf="this.depositsLocked == 0">
							<span class="nothing">No deposits...</span>
						</div>
						<div [ngClass]="{'emulated-flex-gap' : this.getThemingService().isSmallScreen}" fxLayout="row wrap" fxLayoutGap="0px" fxLayoutGap.gt-sm="15px grid">
							<div [fxFlex]="(100/getThemingService().depositGridColumns) + '%'" fxFlex="100%" *ngFor="let item of this.depositsLocked">
								<fieldset class="deposits" fxFlex fxLayout="column" fxLayoutGap="5px">
									<legend class="uppercase orange" fxLayout="row" fxLayoutAlign="space-between center">
										<mat-icon aria-hidden="false">lock</mat-icon>
										{{this.getHelperService().formatAddress(item.address || '')}}
									</legend>
									<div fxLayout="row" fxLayoutAlign="space-between stretch">
										<span class="title">Created</span>
										<span class="amount">{{this.getHelperService().formatDatetime(item.timestamp)}}</span>
									</div>
									<div fxLayout="row" fxLayoutAlign="space-between stretch">
										<span class="title">Amount</span>
										<span class="amount">{{(item.amount / 1000000).toFixed(6)}} CCX</span>
									</div>
									<div fxLayout="row" fxLayoutAlign="space-between stretch">
										<span class="title">Interest</span>
										<span class="amount">{{(item.interest / 1000000).toFixed(6)}} CCX</span>
									</div>
									<div fxLayout="row" fxLayoutAlign="space-between stretch">
										<span class="title">Unlocks</span>
										<span class="amount">In {{this.getHelperService().getUnlockTime(item.unlockHeight, this.blockchainHeight)}}</span>
									</div>
									<div class="progress" fxLayout="column" fxLayoutAlign="start center" fxLayoutGap="15px">
										<div fxLayout="row">
											<span class="title">Progress:</span>
											<span class="amount">{{this.getHelperService().getUnlockPercent(item.height, item.unlockHeight, this.blockchainHeight)}}%</span>
										</div>
										<mat-progress-bar color="accent" mode="buffer" [value]="this.getHelperService().getUnlockPercent(item.height, item.unlockHeight, this.blockchainHeight)"></mat-progress-bar>
									</div>
								</fieldset>
							</div>
						</div>
					</mat-card-content>
				</mat-card>
			</div>

			<!-- Unlocked Deposits -->
			<div id="cards" fxFlex="100" fxFlex.xl="auto">
				<mat-card class="deposit mat-elevation-z6" fxFlex="100%">
					<mat-card-header fxLayout="column">
						<h2 class="title">Unlocked Deposits</h2>
					</mat-card-header>
					<mat-card-content>
						<div *ngIf="this.depositsUnlocked == 0">
							<span class="nothing">No deposits...</span>
						</div>
						<div fxLayout="row wrap" fxLayoutGap="0px" fxLayoutGap.gt-sm="15px grid">
							<div [fxFlex]="(100/getThemingService().depositGridColumns) + '%'" fxFlex="100%" *ngFor="let item of this.depositsUnlocked">
								<fieldset class="deposits" fxFlex fxLayout="column" fxLayoutGap="15px">
									<legend class="uppercase orange" fxLayout="row" fxLayoutAlign="space-between center">
										<mat-icon aria-hidden="false">lock_open</mat-icon>
										{{this.getHelperService().formatAddress(item.address || '')}}
									</legend>
									<div fxLayout="row" fxLayoutAlign="space-between stretch">
										<span class="title">Created</span>
										<span class="amount">{{this.getHelperService().formatDatetime(item.timestamp)}}</span>
									</div>
									<div fxLayout="row" fxLayoutAlign="space-between stretch">
										<span class="title">Amount</span>
										<span class="amount">{{(item.amount / 1000000).toFixed(6)}} CCX</span>
									</div>
									<div fxLayout="row" fxLayoutAlign="space-between stretch">
										<span class="title">Interest</span>
										<span class="amount">{{(item.interest / 1000000).toFixed(6)}} CCX</span>
									</div>
									<div class="progress" fxLayout="column" fxLayoutAlign="start center" fxLayoutGap="15px">
										<div fxLayout="row">
											<span class="title">Progress:</span>
											<span class="amount">{{this.getHelperService().getUnlockPercent(item.height, item.unlockHeight, this.blockchainHeight)}}%</span>
										</div>
										<mat-progress-bar color="accent" [value]="this.getHelperService().getUnlockPercent(item.height, item.unlockHeight, this.blockchainHeight)"></mat-progress-bar>
									</div>
								</fieldset>
							</div>
						</div>
					</mat-card-content>
				</mat-card>
			</div>

		</div>

	</div>

</div>